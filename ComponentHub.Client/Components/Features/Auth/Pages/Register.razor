@page "/Authentication/Register"
@using Microsoft.AspNetCore.Authorization
@inject IdentityAuthenticationStateProvider stateProvider
@inject RegisterRequestValidator validator;
@attribute [Authorize]

<PageTitle>Register</PageTitle>

<MudCard>
    <MudForm Model="formModel" Validation="validator.ValidateValue">
        <MudCardHeader>
            <MudText Typo="Typo.h1">Register your account</MudText>
        </MudCardHeader>
        <MudCardContent>
            <MudText>
                The username you choose will serve only as a display name.
            </MudText>
            <MudTextField HelperText="Public username" @bind-Value="@formModel.UserName" For="() => formModel.UserName" Immediate="true"></MudTextField>
        </MudCardContent>
        <MudCardActions>
            <MudButton OnClick="OnValidSubmit">Register Account</MudButton>
        </MudCardActions>
    </MudForm>
</MudCard>


@code {
    private readonly RegisterRequest formModel = new();

    [SupplyParameterFromQuery] private string? InitialUserName { get; set; }

    private Task OnValidSubmit()
    {
        return stateProvider.Register(formModel);
    }

    protected override void OnParametersSet()
    {
        if (InitialUserName is null) return;


        formModel.UserName = InitialUserName;
    }
}
